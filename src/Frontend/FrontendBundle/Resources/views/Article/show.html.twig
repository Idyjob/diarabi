{% extends "::/layout/layoutadmin.html.twig" %}

{% block title %}Article - {{ parent() }}{% endblock %}


{% set comments = article.comments%}
{% set photos = article.photos %}
{% set videos = article.videos %}
{% set likes = article.likes%}

{% block body %}


    <h1>Article: {{article.titre}}</h1>

    <!--timeline-->
    <section class="timeline col-sm-12">
    <!--post Timeline-->
    <div class="thumbnail thumbnail-post">
        <!--caption-->
        <div class="caption">
            <div class="media">
              <div class="media-left">
                <a href="#" class="image-post">
                 <img src="{{gravatar('anissa.djeraye@gmail.com')}}">
                </a>
              </div>
              <div class="media-body">
                <a class="media-heading title-post" href="#">{{article.titre}}</a>
                <h5 class="time-post">3 minutes ago</h5>
              </div>
            </div>
          <p> {{article.contenu|raw}}</p>
          {% if videos and videos|length == 1%}
          <p>{% include 'FrontendBundle:Media:display_single_video.html.twig' with {media: videos|first} %}</p>
          {% endif%}





        </div><!--#caption-->
        <div class="links-post">
            <span class="fa fa-thumbs-o-up link-post"></span><a href="#" class="link-post" role="button">Like ({% if likes and likes|length > 0%} {{likes|length}} {%else %} 0 {% endif%})</a>
            <span class="fa fa-comment link-post"></span><a href="#" class="link-post" data-toggle="collapse" data-target=".allcomments_{{article.id}}" role="button">Comment ({% if comments and comments|length > 0%} {{comments|length}} {%else %} 0 {% endif%})</a>

        </div>
        <!--  all comments-->
        <div id="{{article.id}}" class="collapse allcomments_{{article.id}}" >
          <!-- commentform-->
          <div class="media commentform">
                  <div class="media-left">
                      <a href="#" class="image-post">
                          <img src="{{gravatar(app.user.email)}}"   >
                      </a>
                  </div>
                  <div class="media-body">

                       <textarea id="{{article.id}}" placeholder="comment ..." class="facebookbordercolor commentinput" style="width:100%"></textarea>
                  </div>
            </div>
          <!-- end commentform-->
          {% if comments|length > 0 %}
          {% for comment in comments%}
              <div class="media .allcomments_{{article.id}}">
                      <div class="media-left">
                          <a href="{{path('admin_users_show',{'id':comment.user.id})}}" class="image-post">
                              <img src="{{gravatar(comment.user.email)}}"   >
                          </a>
                      </div>
                      <div class="media-body">
                          <h4 class="media-heading"><a href="{{path('admin_users_show',{'id':comment.user.id})}}" >{{comment.user.username}} </a> <small><i>Posted on January 10, 2014</i></small></h4>
                          <p> {{comment.contenu}}</p>
                      </div>
                </div>

        {% endfor%}
        {%endif%}
</div>
        <!--  end all comments-->
    </div>

    <!--#post timeline-->
  </section>

    {{ form_start(delete_form) }}
        {{ form_widget(delete_form) }}

        <div class="btn-group record_actions">

            <a class="btn btn-info" href="{{ path('admin_articles') }}">
                <i class="fa fa-list"></i> {{ 'Back to the list'|trans({}, 'admin') }}
            </a>

            <a class="btn btn-primary" href="{{ path('admin_articles_edit', {id: article.id}) }}">
                <i class="fa fa-edit"></i> {{ 'Edit'|trans({}, 'admin') }}
            </a>
            <button class="btn btn-danger" type="submit"><i class="fa fa-trash-o"></i> {{ 'Delete'|trans({}, 'admin') }}</button>

        </div>

        <input name="modal" type="hidden" value="0">
    {{ form_end(delete_form) }}

    <div id="delete_confirm" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3>{{ 'Confirm delete'|trans({}, 'admin') }}</h3>
                </div>
                <div class="modal-body">
                    <p>{{ 'You are about to delete an item'|trans({}, 'admin') }}, {{ 'this procedure is irreversible'|trans({}, 'admin') }}.</p>
                    <p>{{ 'Do you want to proceed?'|trans({}, 'admin') }}</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger">{{ 'Yes'|trans({}, 'admin') }}</button>
                    <button class="btn btn-default" data-dismiss="modal">{{ 'No'|trans({}, 'admin') }}</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block javascripts %}
<script>
function addCommentArticle(id,comment){

  $.ajax({
    type: "POST",
    url : Routing.generate('addCommentArticle', {id:id}),
    data: {comment:comment},
    error: function(error)
            {
            alert(error);
          },
    success: function(data){


    }
  });


}
$("textarea.commentinput").keypress(function(event) {
  if (event.which == 13) {
      event.preventDefault();
      var id = $(this).attr('id');
      var comment = $(this).val();
      addCommentArticle(id,comment);
  }
});
</script>
{% endblock %}
